<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sauvegarde Profil - PostSocial</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #34495e;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .profile-info {
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.configured {
            background: #d4edda;
            color: #155724;
        }
        .status.not-configured {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Sauvegarde Profil LinkedIn</h1>
        
        <div class="test-section">
            <h3>üìä √âtat du Profil</h3>
            <div id="profile-status"></div>
            <div id="profile-info"></div>
        </div>
        
        <div class="test-section">
            <h3>üíæ Sauvegarder un Profil</h3>
            <form id="profile-form">
                <div class="form-group">
                    <label for="email">Email LinkedIn *</label>
                    <input type="email" id="email" name="email" placeholder="votre.email@exemple.com" required>
                </div>
                <div class="form-group">
                    <label for="password">Mot de passe LinkedIn *</label>
                    <input type="password" id="password" name="password" placeholder="Votre mot de passe" required>
                </div>
                <div class="form-group">
                    <label for="profileUrl">URL du profil LinkedIn (optionnel)</label>
                    <input type="url" id="profileUrl" name="profileUrl" placeholder="https://www.linkedin.com/in/votre-profil">
                </div>
                <button type="submit">üíæ Sauvegarder le Profil</button>
                <button type="button" onclick="clearProfile()">üóëÔ∏è Effacer le Profil</button>
            </form>
            <div id="save-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üîç Tests de Validation</h3>
            <button onclick="testValidation()">üß™ Tester la Validation</button>
            <button onclick="testStorage()">üíæ Tester le Stockage</button>
            <button onclick="testRetrieval()">üì• Tester la R√©cup√©ration</button>
            <div id="validation-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìã Logs de Test</h3>
            <div id="test-logs"></div>
        </div>
    </div>

    <script>
        class ProfileTester {
            constructor() {
                this.logs = [];
                this.init();
            }
            
            init() {
                this.updateProfileStatus();
                this.setupEventListeners();
                this.log('üöÄ Testeur de profil initialis√©');
            }
            
            setupEventListeners() {
                const form = document.getElementById('profile-form');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProfile();
                });
            }
            
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] ${message}`;
                this.logs.unshift(logEntry);
                
                // Limiter les logs √† 50 entr√©es
                if (this.logs.length > 50) {
                    this.logs = this.logs.slice(0, 50);
                }
                
                this.updateLogsDisplay();
                console.log(logEntry);
            }
            
            updateLogsDisplay() {
                const logsDiv = document.getElementById('test-logs');
                logsDiv.innerHTML = this.logs.map(log => `<div>${log}</div>`).join('');
            }
            
            updateProfileStatus() {
                const statusDiv = document.getElementById('profile-status');
                const infoDiv = document.getElementById('profile-info');
                
                try {
                    const profile = this.getProfile();
                    
                    if (profile && profile.email && profile.password) {
                        statusDiv.innerHTML = `<span class="status configured">‚úÖ Profil Configur√©</span>`;
                        infoDiv.innerHTML = `
                            <div class="profile-info">
                                <strong>Email:</strong> ${profile.email}<br>
                                <strong>URL du profil:</strong> ${profile.profileUrl || 'Non sp√©cifi√©e'}<br>
                                <strong>Sauvegard√© le:</strong> ${new Date(profile.savedAt).toLocaleString()}
                            </div>
                        `;
                    } else {
                        statusDiv.innerHTML = `<span class="status not-configured">‚ùå Aucun Profil Configur√©</span>`;
                        infoDiv.innerHTML = '<em>Aucun profil LinkedIn n\'est actuellement sauvegard√©.</em>';
                    }
                } catch (error) {
                    statusDiv.innerHTML = `<span class="status not-configured">‚ùå Erreur de Lecture</span>`;
                    infoDiv.innerHTML = `<em>Erreur lors de la lecture du profil: ${error.message}</em>`;
                }
            }
            
            getProfile() {
                try {
                    const profile = localStorage.getItem('linkedinProfile');
                    return profile ? JSON.parse(profile) : null;
                } catch (error) {
                    throw new Error(`Erreur parsing JSON: ${error.message}`);
                }
            }
            
            saveProfile() {
                this.log('üíæ Tentative de sauvegarde du profil...');
                
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const profileUrl = document.getElementById('profileUrl').value.trim();
                
                // Validation
                if (!email) {
                    this.showResult('‚ùå Veuillez saisir un email valide', 'error');
                    return;
                }
                
                if (!password) {
                    this.showResult('‚ùå Veuillez saisir un mot de passe', 'error');
                    return;
                }
                
                // Validation email basique
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    this.showResult('‚ùå Format d\'email invalide', 'error');
                    return;
                }
                
                try {
                    const profile = {
                        email,
                        password,
                        profileUrl: profileUrl || '',
                        savedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('linkedinProfile', JSON.stringify(profile));
                    
                    this.showResult('‚úÖ Profil sauvegard√© avec succ√®s !', 'success');
                    this.updateProfileStatus();
                    this.log('‚úÖ Profil sauvegard√© avec succ√®s');
                    
                    // R√©initialiser le formulaire
                    document.getElementById('profile-form').reset();
                    
                } catch (error) {
                    this.showResult(`‚ùå Erreur lors de la sauvegarde: ${error.message}`, 'error');
                    this.log(`‚ùå Erreur sauvegarde: ${error.message}`);
                }
            }
            
            clearProfile() {
                try {
                    localStorage.removeItem('linkedinProfile');
                    this.showResult('üóëÔ∏è Profil supprim√© avec succ√®s', 'info');
                    this.updateProfileStatus();
                    this.log('üóëÔ∏è Profil supprim√©');
                } catch (error) {
                    this.showResult(`‚ùå Erreur lors de la suppression: ${error.message}`, 'error');
                    this.log(`‚ùå Erreur suppression: ${error.message}`);
                }
            }
            
            showResult(message, type) {
                const resultDiv = document.getElementById('save-result');
                resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
                
                // Effacer le message apr√®s 5 secondes
                setTimeout(() => {
                    resultDiv.innerHTML = '';
                }, 5000);
            }
            
            testValidation() {
                this.log('üß™ Test de validation...');
                
                const tests = [
                    { email: '', password: 'test123', expected: false, description: 'Email vide' },
                    { email: 'invalid-email', password: 'test123', expected: false, description: 'Email invalide' },
                    { email: 'test@example.com', password: '', expected: false, description: 'Mot de passe vide' },
                    { email: 'test@example.com', password: 'test123', expected: true, description: 'Donn√©es valides' },
                    { email: 'user@domain.co.uk', password: 'password123', expected: true, description: 'Email avec sous-domaine' }
                ];
                
                let results = [];
                tests.forEach(test => {
                    const isValid = this.validateProfileData(test.email, test.password);
                    const passed = isValid === test.expected;
                    results.push({
                        test: test.description,
                        passed,
                        expected: test.expected,
                        actual: isValid
                    });
                });
                
                this.displayValidationResults(results);
            }
            
            validateProfileData(email, password) {
                if (!email || !password) return false;
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email.trim());
            }
            
            displayValidationResults(results) {
                const resultDiv = document.getElementById('validation-result');
                const passedCount = results.filter(r => r.passed).length;
                const totalCount = results.length;
                
                let html = `<div class="result ${passedCount === totalCount ? 'success' : 'error'}">`;
                html += `<strong>R√©sultats des tests de validation: ${passedCount}/${totalCount}</strong>\n\n`;
                
                results.forEach(result => {
                    const icon = result.passed ? '‚úÖ' : '‚ùå';
                    html += `${icon} ${result.test}: ${result.passed ? 'PASS√â' : '√âCHOU√â'}\n`;
                    if (!result.passed) {
                        html += `  Attendu: ${result.expected}, Obtenu: ${result.actual}\n`;
                    }
                });
                
                html += '</div>';
                resultDiv.innerHTML = html;
            }
            
            testStorage() {
                this.log('üíæ Test de stockage...');
                
                try {
                    // Test d'√©criture
                    const testData = { test: true, timestamp: Date.now() };
                    localStorage.setItem('testProfile', JSON.stringify(testData));
                    
                    // Test de lecture
                    const retrieved = JSON.parse(localStorage.getItem('testProfile'));
                    const writeSuccess = retrieved && retrieved.test === true;
                    
                    // Test de suppression
                    localStorage.removeItem('testProfile');
                    const deleteSuccess = !localStorage.getItem('testProfile');
                    
                    const resultDiv = document.getElementById('validation-result');
                    const allSuccess = writeSuccess && deleteSuccess;
                    
                    let html = `<div class="result ${allSuccess ? 'success' : 'error'}">`;
                    html += '<strong>Test de stockage localStorage:</strong>\n\n';
                    html += `${writeSuccess ? '‚úÖ' : '‚ùå'} √âcriture: ${writeSuccess ? 'R√âUSSIE' : '√âCHOU√âE'}\n`;
                    html += `${deleteSuccess ? '‚úÖ' : '‚ùå'} Suppression: ${deleteSuccess ? 'R√âUSSIE' : '√âCHOU√âE'}\n`;
                    html += '</div>';
                    
                    resultDiv.innerHTML = html;
                    
                    this.log(`üíæ Test stockage: ${allSuccess ? 'R√âUSSI' : '√âCHOU√â'}`);
                    
                } catch (error) {
                    this.log(`‚ùå Erreur test stockage: ${error.message}`);
                    const resultDiv = document.getElementById('validation-result');
                    resultDiv.innerHTML = `<div class="result error">‚ùå Erreur lors du test de stockage: ${error.message}</div>`;
                }
            }
            
            testRetrieval() {
                this.log('üì• Test de r√©cup√©ration...');
                
                try {
                    const profile = this.getProfile();
                    const hasProfile = profile !== null;
                    
                    const resultDiv = document.getElementById('validation-result');
                    let html = `<div class="result ${hasProfile ? 'success' : 'info'}">`;
                    html += '<strong>Test de r√©cup√©ration du profil:</strong>\n\n';
                    
                    if (hasProfile) {
                        html += '‚úÖ Profil trouv√©\n';
                        html += `  Email: ${profile.email}\n`;
                        html += `  URL: ${profile.profileUrl || 'Non sp√©cifi√©e'}\n`;
                        html += `  Sauvegard√©: ${new Date(profile.savedAt).toLocaleString()}\n`;
                    } else {
                        html += '‚ÑπÔ∏è Aucun profil trouv√©\n';
                    }
                    
                    html += '</div>';
                    resultDiv.innerHTML = html;
                    
                    this.log(`üì• Test r√©cup√©ration: ${hasProfile ? 'PROFIL TROUV√â' : 'AUCUN PROFIL'}`);
                    
                } catch (error) {
                    this.log(`‚ùå Erreur test r√©cup√©ration: ${error.message}`);
                    const resultDiv = document.getElementById('validation-result');
                    resultDiv.innerHTML = `<div class="result error">‚ùå Erreur lors du test de r√©cup√©ration: ${error.message}</div>`;
                }
            }
        }
        
        // Initialisation du testeur
        let tester;
        document.addEventListener('DOMContentLoaded', () => {
            tester = new ProfileTester();
        });
        
        // Fonctions globales pour les boutons
        function clearProfile() {
            if (tester) tester.clearProfile();
        }
        
        function testValidation() {
            if (tester) tester.testValidation();
        }
        
        function testStorage() {
            if (tester) tester.testStorage();
        }
        
        function testRetrieval() {
            if (tester) tester.testRetrieval();
        }
    </script>
</body>
</html>

