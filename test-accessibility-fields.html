<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Accessibilit√© des Champs - PostSocial</title>
    <link rel="stylesheet" href="design-fixes.css">
    <style>
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0077b5;
            box-shadow: 0 0 0 3px rgba(0, 119, 181, 0.1);
            background: white;
        }
        
        .form-group input:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: #0077b5;
            background: white;
        }
        
        .form-group input:disabled,
        .form-group select:disabled,
        .form-group textarea:disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
            border-color: #ddd;
        }
        
        .required {
            color: #e74c3c;
            font-weight: bold;
            margin-left: 4px;
        }
        
        .field-help {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #0077b5;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #0077b5 0%, #667eea 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }
        
        .generate-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .test-results h4 {
            margin-top: 0;
            color: #333;
        }
        
        .test-log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 4px;
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-indicator.connected {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-indicator.error {
            background: #ffebee;
            color: #c62828;
        }
        
        .accessibility-test {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .accessibility-test h5 {
            margin: 0 0 10px 0;
            color: #856404;
        }
        
        .accessibility-test ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .accessibility-test li {
            margin: 5px 0;
            color: #856404;
        }
        
        .field-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .field-status.accessible {
            background: #d4edda;
            color: #155724;
        }
        
        .field-status.not-accessible {
            background: #f8d7da;
            color: #721c24;
        }
        
        .field-status.readonly {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test d'Accessibilit√© des Champs - PostSocial</h1>
        
        <div class="test-section">
            <h3>üìù Bloc "G√©n√©rateur de posts LinkedIn" - Test d'Accessibilit√©</h3>
            <p>Ce test v√©rifie que tous les champs du g√©n√©rateur de posts sont accessibles et modifiables.</p>
            
            <div class="accessibility-test">
                <h5>üéØ Objectifs du Test :</h5>
                <ul>
                    <li>‚úÖ V√©rifier que tous les champs sont visibles et accessibles</li>
                    <li>‚úÖ V√©rifier que tous les champs sont modifiables (sauf r√©sultat)</li>
                    <li>‚úÖ V√©rifier que les labels et aides sont pr√©sents</li>
                    <li>‚úÖ V√©rifier que la navigation clavier fonctionne</li>
                    <li>‚úÖ V√©rifier que les √©tats disabled/readonly sont corrects</li>
                </ul>
            </div>
            
            <form id="testForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="subject" id="subjectLabel">
                            Sujet du post <span class="required">*</span>
                            <span class="field-status" id="subjectStatus">Test en cours...</span>
                        </label>
                        <textarea id="subject" name="subject" rows="3" required 
                                  placeholder="D√©crivez le sujet de votre post LinkedIn en quelques lignes..."
                                  aria-describedby="subject-help"></textarea>
                        <div id="subject-help" class="field-help">
                            Par exemple : votre expertise, une r√©flexion professionnelle, une actualit√© de votre secteur, etc.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="audience" id="audienceLabel">
                            Audience cible <span class="required">*</span>
                            <span class="field-status" id="audienceStatus">Test en cours...</span>
                        </label>
                        <select id="audience" name="audience" required>
                            <option value="">Choisir une audience...</option>
                            <option value="professionals">Professionnels exp√©riment√©s</option>
                            <option value="juniors">Jeunes professionnels</option>
                            <option value="entrepreneurs">Entrepreneurs</option>
                            <option value="managers">Managers et dirigeants</option>
                            <option value="students">√âtudiants</option>
                            <option value="recruiters">Recruteurs RH</option>
                        </select>
                        <div id="audience-help" class="field-help">
                            S√©lectionnez le type de professionnels que vous souhaitez cibler avec votre post
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tone" id="toneLabel">
                            Ton du message <span class="required">*</span>
                            <span class="field-status" id="toneStatus">Test en cours...</span>
                        </label>
                        <select id="tone" name="tone" required>
                            <option value="">Choisir un ton...</option>
                            <option value="professional">Professionnel</option>
                            <option value="inspirational">Inspirant</option>
                            <option value="casual">D√©contract√©</option>
                            <option value="educational">√âducatif</option>
                            <option value="motivational">Motivant</option>
                            <option value="thoughtful">R√©fl√©chi</option>
                        </select>
                        <div id="tone-help" class="field-help">
                            D√©finissez l'ambiance et le style de votre message LinkedIn
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="postLanguage" id="postLanguageLabel">
                            Langue du post <span class="required">*</span>
                            <span class="field-status" id="postLanguageStatus">Test en cours...</span>
                        </label>
                        <select id="postLanguage" name="postLanguage" required>
                            <option value="fr">Fran√ßais</option>
                            <option value="en">English</option>
                        </select>
                        <div id="language-help" class="field-help">
                            Choisissez la langue dans laquelle votre post sera g√©n√©r√©
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="ollamaModel" id="ollamaModelLabel">
                            Mod√®le IA <span class="required">*</span>
                            <span class="field-status" id="ollamaModelStatus">Test en cours...</span>
                        </label>
                        <select id="ollamaModel" name="ollamaModel" required>
                            <option value="">Chargement des mod√®les...</option>
                            <option value="llama3.2:3b">Llama 3.2 3B</option>
                            <option value="llama3.2:8b">Llama 3.2 8B</option>
                            <option value="llama3.2:70b">Llama 3.2 70B</option>
                            <option value="mistral:7b">Mistral 7B</option>
                            <option value="mistral:11b">Mistral 11B</option>
                        </select>
                        <div id="model-help" class="field-help">
                            S√©lectionnez le mod√®le d'intelligence artificielle qui g√©n√©rera votre post
                        </div>
                        <div class="model-info" id="modelInfo" style="display: none;">
                            <small class="text-muted">
                                <span id="modelDescription"></span>
                                <span id="modelSize"></span>
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ollamaStatus" id="ollamaStatusLabel">
                            Statut du serveur
                            <span class="field-status" id="ollamaStatusStatus">Test en cours...</span>
                        </label>
                        <div class="ollama-status-display" id="ollamaStatusDisplay">
                            <div class="status-indicator" id="ollamaStatusIndicator">
                                <svg class="icon" viewBox="0 0 24 24" width="16" height="16">
                                    <path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2zm0 18a8 8 0 0 1-8-8 8 8 0 0 1 8-8 8 8 0 0 1 8 8 8 8 0 0 1-8 8z"/>
                                    <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                                <span>V√©rification de la connectivit√©...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="generate-btn" id="generateBtn">
                    <svg class="icon" viewBox="0 0 24 24" width="20" height="20" style="margin-right: 8px;">
                        <path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2zm0 18a8 8 0 0 1-8-8 8 8 0 0 1 8-8 8 8 0 0 1 8 8 8 8 0 0 1-8 8z"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    <span>G√©n√©rer mon post LinkedIn</span>
                </button>
                <div id="generate-help" class="field-help">
                    Cliquez pour g√©n√©rer votre post LinkedIn avec l'intelligence artificielle
                </div>
            </form>

            <!-- R√©sultat (lecture seule) -->
            <div class="post-result" id="postResult" style="display: none; margin-top: 20px;">
                <h3>Votre post LinkedIn :</h3>
                <div class="post-content" id="postContent" 
                     role="textbox" 
                     aria-readonly="true" 
                     style="background: #f8f9fa; padding: 15px; border-radius: 6px; border: 1px solid #e9ecef; min-height: 100px;">
                    Aucun post g√©n√©r√© pour le moment...
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä R√©sultats des Tests d'Accessibilit√©</h3>
            
            <div class="test-results">
                <h4>‚úÖ Test des Champs Modifiables</h4>
                <div id="fieldAccessibilityResults">Tests en cours...</div>
            </div>
            
            <div class="test-results">
                <h4>üîç Test de Navigation Clavier</h4>
                <div id="keyboardNavigationResults">Tests en cours...</div>
            </div>
            
            <div class="test-results">
                <h4>üìù Test de Modification des Valeurs</h4>
                <div id="valueModificationResults">Tests en cours...</div>
            </div>
            
            <div class="test-results">
                <h4>üìã Logs de Test</h4>
                <div class="test-log" id="testLogs">Logs de test d'accessibilit√©...</div>
            </div>
        </div>
    </div>
    
    <script>
        class FieldAccessibilityTester {
            constructor() {
                this.form = document.getElementById('testForm');
                this.testLogs = document.getElementById('testLogs');
                this.fieldAccessibilityResults = document.getElementById('fieldAccessibilityResults');
                this.keyboardNavigationResults = document.getElementById('keyboardNavigationResults');
                this.valueModificationResults = document.getElementById('valueModificationResults');
                
                this.fields = {
                    subject: document.getElementById('subject'),
                    audience: document.getElementById('audience'),
                    tone: document.getElementById('tone'),
                    postLanguage: document.getElementById('postLanguage'),
                    ollamaModel: document.getElementById('ollamaModel'),
                    ollamaStatus: document.getElementById('ollamaStatusDisplay')
                };
                
                this.init();
            }
            
            init() {
                this.log('üß™ Initialisation du testeur d\'accessibilit√© des champs...');
                this.runAccessibilityTests();
                this.setupEventListeners();
                this.log('‚úÖ Testeur d\'accessibilit√© initialis√©');
            }
            
            setupEventListeners() {
                // Test de modification des valeurs
                Object.values(this.fields).forEach(field => {
                    if (field && field.tagName !== 'DIV') {
                        field.addEventListener('input', () => this.testValueModification(field));
                        field.addEventListener('change', () => this.testValueModification(field));
                        field.addEventListener('focus', () => this.log(`üîç Focus sur ${field.name || field.id}`));
                    }
                });
                
                // Test de navigation clavier
                this.form.addEventListener('keydown', (e) => this.testKeyboardNavigation(e));
                
                // Test de soumission
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.testFormSubmission();
                });
            }
            
            async runAccessibilityTests() {
                this.log('üöÄ D√©marrage des tests d\'accessibilit√©...');
                
                // Test 1: Accessibilit√© des champs
                await this.testFieldAccessibility();
                
                // Test 2: Navigation clavier
                await this.testKeyboardNavigationComprehensive();
                
                // Test 3: Modification des valeurs
                await this.testValueModificationComprehensive();
                
                this.log('‚úÖ Tous les tests d\'accessibilit√© termin√©s');
            }
            
            async testFieldAccessibility() {
                this.log('üîç Test de l\'accessibilit√© des champs...');
                
                const results = [];
                
                Object.entries(this.fields).forEach(([fieldName, field]) => {
                    if (!field) {
                        results.push(`‚ùå Champ ${fieldName} non trouv√©`);
                        return;
                    }
                    
                    const status = this.getFieldStatus(field);
                    const isAccessible = this.isFieldAccessible(field);
                    
                    // Mettre √† jour le statut visuel
                    const statusElement = document.getElementById(`${fieldName}Status`);
                    if (statusElement) {
                        statusElement.className = `field-status ${isAccessible ? 'accessible' : 'not-accessible'}`;
                        statusElement.textContent = isAccessible ? 'Accessible' : 'Non accessible';
                    }
                    
                    results.push(`${isAccessible ? '‚úÖ' : '‚ùå'} ${fieldName}: ${status}`);
                });
                
                this.fieldAccessibilityResults.innerHTML = `
                    <div style="color: #27ae60; font-weight: bold;">Test d'accessibilit√© des champs termin√©</div>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${results.map(result => `<li>${result}</li>`).join('')}
                    </ul>
                `;
                
                this.log('‚úÖ Test d\'accessibilit√© des champs termin√©');
            }
            
            getFieldStatus(field) {
                if (field.disabled) return 'D√©sactiv√©';
                if (field.readOnly) return 'Lecture seule';
                if (field.tagName === 'DIV') return 'Affichage seulement';
                return 'Modifiable';
            }
            
            isFieldAccessible(field) {
                if (field.tagName === 'DIV') return true; // Affichage seulement
                if (field.disabled) return false;
                if (field.readOnly) return false;
                if (field.style.display === 'none') return false;
                if (field.style.visibility === 'hidden') return false;
                return true;
            }
            
            async testKeyboardNavigationComprehensive() {
                this.log('‚å®Ô∏è Test de navigation clavier...');
                
                const results = [];
                
                // Test de navigation Tab
                const tabbableElements = this.getTabbableElements();
                results.push(`üì± √âl√©ments navigables par Tab: ${tabbableElements.length}`);
                
                // Test de focus
                tabbableElements.forEach((element, index) => {
                    element.addEventListener('focus', () => {
                        this.log(`üîç Focus sur l'√©l√©ment ${index + 1}: ${element.name || element.id}`);
                    });
                });
                
                this.keyboardNavigationResults.innerHTML = `
                    <div style="color: #27ae60; font-weight: bold;">Test de navigation clavier termin√©</div>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>üì± √âl√©ments navigables par Tab: ${tabbableElements.length}</li>
                        <li>üîç Test de focus configur√© sur tous les √©l√©ments</li>
                        <li>‚å®Ô∏è Utilisez Tab/Shift+Tab pour naviguer</li>
                        <li>üîç Utilisez Entr√©e/Espace pour activer</li>
                    </ul>
                `;
                
                this.log('‚úÖ Test de navigation clavier termin√©');
            }
            
            getTabbableElements() {
                const tabbable = [];
                const elements = this.form.querySelectorAll('input, select, textarea, button');
                
                elements.forEach(element => {
                    if (!element.disabled && element.style.display !== 'none') {
                        tabbable.push(element);
                    }
                });
                
                return tabbable;
            }
            
            testKeyboardNavigation(e) {
                if (e.key === 'Tab') {
                    this.log(`‚å®Ô∏è Navigation Tab: ${e.target.name || e.target.id}`);
                } else if (e.key === 'Enter' && e.target.tagName === 'BUTTON') {
                    this.log(`‚å®Ô∏è Activation bouton: ${e.target.textContent}`);
                }
            }
            
            async testValueModificationComprehensive() {
                this.log('‚úèÔ∏è Test de modification des valeurs...');
                
                const results = [];
                
                Object.entries(this.fields).forEach(([fieldName, field]) => {
                    if (!field || field.tagName === 'DIV') return;
                    
                    const canModify = this.canFieldBeModified(field);
                    const testValue = this.getTestValue(field);
                    
                    if (canModify) {
                        try {
                            this.setFieldValue(field, testValue);
                            const currentValue = this.getFieldValue(field);
                            const success = currentValue === testValue;
                            
                            results.push(`${success ? '‚úÖ' : '‚ùå'} ${fieldName}: ${success ? 'Modifiable' : 'Erreur de modification'}`);
                            
                            // Restaurer la valeur originale
                            this.restoreFieldValue(field);
                        } catch (error) {
                            results.push(`‚ùå ${fieldName}: Erreur lors du test - ${error.message}`);
                        }
                    } else {
                        results.push(`‚ö†Ô∏è ${fieldName}: Non modifiable (${this.getFieldStatus(field)})`);
                    }
                });
                
                this.valueModificationResults.innerHTML = `
                    <div style="color: #27ae60; font-weight: bold;">Test de modification des valeurs termin√©</div>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${results.map(result => `<li>${result}</li>`).join('')}
                    </ul>
                `;
                
                this.log('‚úÖ Test de modification des valeurs termin√©');
            }
            
            canFieldBeModified(field) {
                return !field.disabled && !field.readOnly && field.style.display !== 'none';
            }
            
            getTestValue(field) {
                if (field.tagName === 'TEXTAREA') return 'Test de modification - Sujet de post LinkedIn';
                if (field.tagName === 'SELECT') {
                    const options = Array.from(field.options).filter(opt => opt.value);
                    return options.length > 0 ? options[0].value : '';
                }
                return 'Test';
            }
            
            setFieldValue(field, value) {
                if (field.tagName === 'TEXTAREA' || field.tagName === 'INPUT') {
                    field.value = value;
                    field.dispatchEvent(new Event('input', { bubbles: true }));
                } else if (field.tagName === 'SELECT') {
                    field.value = value;
                    field.dispatchEvent(new Event('change', { bubbles: true }));
                }
            }
            
            getFieldValue(field) {
                return field.value;
            }
            
            restoreFieldValue(field) {
                if (field.tagName === 'TEXTAREA' || field.tagName === 'INPUT') {
                    field.value = '';
                } else if (field.tagName === 'SELECT') {
                    field.selectedIndex = 0;
                }
            }
            
            testValueModification(field) {
                this.log(`‚úèÔ∏è Modification d√©tect√©e sur ${field.name || field.id}: "${field.value}"`);
            }
            
            async testFormSubmission() {
                this.log('üì§ Test de soumission du formulaire...');
                
                const formData = new FormData(this.form);
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }
                
                this.log(`üìù Donn√©es du formulaire: ${JSON.stringify(data, null, 2)}`);
                
                // Simuler la g√©n√©ration
                this.postResult.style.display = 'block';
                this.postContent.innerHTML = `
                    <strong>Test de soumission r√©ussi !</strong><br><br>
                    <strong>Sujet:</strong> ${data.subject || 'Non renseign√©'}<br>
                    <strong>Audience:</strong> ${data.audience || 'Non renseign√©'}<br>
                    <strong>Ton:</strong> ${data.tone || 'Non renseign√©'}<br>
                    <strong>Langue:</strong> ${data.postLanguage || 'Non renseign√©'}<br>
                    <strong>Mod√®le:</strong> ${data.ollamaModel || 'Non renseign√©'}<br><br>
                    <em>Ceci est un test d'accessibilit√© - aucun post r√©el n'a √©t√© g√©n√©r√©.</em>
                `;
                
                this.log('‚úÖ Test de soumission du formulaire termin√©');
            }
            
            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.testLogs.innerHTML += `[${timestamp}] ${message}\n`;
                this.testLogs.scrollTop = this.testLogs.scrollHeight;
                console.log(message);
            }
        }
        
        // Initialisation du testeur
        document.addEventListener('DOMContentLoaded', () => {
            new FieldAccessibilityTester();
        });
    </script>
</body>
</html>
